@page
@using CinemaBooking.Enum
@model CinemaBooking.Pages.Customer.CinemaSelection.SeatSelectionModel
@{
    Layout = "/Pages/Shared/_UserLayout.cshtml";
    ViewData["Title"] = "Cinema Selection";
}
<!DOCTYPE html>
<html lang="zxx">

<head>
    <title>Movie Seat Selection Flat Responsive Widget Template :: w3layouts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="keywords" content="Movie Seat Selection a Responsive Web Template, Bootstrap Web Templates, Flat Web Templates, Android Compatible Web Template, Smartphone Compatible Web Template, Free Webdesigns for Nokia, Samsung, LG, Sony Ericsson, Motorola Web Design">
    <link rel="stylesheet" href="~/customer/seat-selection-assets/css/style.css" type="text/css" media="all">
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,200i,300,300i,400,400i,600,600i,700,700i,900,900i" rel="stylesheet">
    <style>
        .seats {
            display: none; /* Hide default checkbox */
        }

        .checkmark {
            width: 20px;
            height: 20px;
            background-color: #eee;
            border-radius: 5px; /* Optional: rounded corners */
            display: inline-block; /* Inline block to allow space beside text */
            position: relative; /* For the checkmark positioning */
            cursor: pointer; /* Pointer cursor on hover */
        }

        /* Checkmark appearance when checked */
        .seats:checked + .checkmark {
            background-color: #28a745; /* Green background for selected */
        }

        /* Adding styles for reserved or unavailable seats */
        .unavailable + .checkmark {
            background-color: yellow; /* Yellow for unavailable */
        }

        .reserved + .checkmark {
            background-color: red; /* Red for reserved */
        }

        /* Optional: Change cursor for unavailable seats */
        .unavailable + .checkmark,
        .reserved + .checkmark {
            cursor: not-allowed; /* Not-allowed cursor */
        }

        /* Style for seat labels */
        .checkbox-label {
            margin-left: 5px; /* Space between checkbox and text */
            font-weight: bold; /* Make the text bold */
            color: #333; /* Change label color */
        }

        .label-text {
            margin-bottom: 5px; /* Khoảng cách giữa label và input */
            font-weight: bold; /* Đậm hơn để nổi bật */
        }

        .w3ls-reg {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        input[type="text"], input[type="number"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

            button:hover {
                background-color: #45a049;
            }

        .seat_w3ls, .Displaytable {
            justify-content: space-between;
            width: 100%;
            text-align: center;
            margin-top: 15px;
        }

            .Displaytable th, .Displaytable td {
                padding: 10px;
                border: 1px solid #ddd;
            }

        .Displaytable {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        textarea {
            width: 100%;
            resize: none;
            padding: 10px;
            box-sizing: border-box;
        }

        .screen {
            margin: 20px 0;
        }

        #seatsBlock {
            width: 100%;
            border-spacing: 10px; /* Tạo khoảng cách giữa các ghế */
        }

            #seatsBlock td {
                text-align: center;
            }

        .checkmark {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .screen h2 {
            font-size: 1.3em;
            font-weight: bold;
        }

        .txt-center {
            text-align: center;
        }

        .displayerBoxes {
            border: 1px solid #ddd; /* Light border around the box */
            border-radius: 8px; /* Rounded corners */
            padding: 20px; /* Padding inside the box */
            background-color: rgba(128, 128, 128, 0); /* Fully transparent background for the box */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            margin-top: 20px; /* Margin above the box */
        }

        .Displaytable {
            width: 100%; /* Full width */
            border-collapse: collapse; /* Collapse borders */
            background-color: rgba(128, 128, 128, 0.34); /* Light gray background with transparency for the entire table */
        }

            .Displaytable th,
            .Displaytable td {
                border: 1px solid #ddd; /* Light border for cells */
                padding: 12px; /* Padding for table cells */
                text-align: left; /* Left-aligned text */
                background-color: rgba(128, 128, 128, 0.34); /* Light gray background with transparency for cells */
            }

            .Displaytable th {
                color: white; /* Header text color */
                padding-bottom: 15px; /* Add space below the header */
            }

            .Displaytable tbody tr {
                transition: background-color 0.3s; /* Smooth transition for row hover effect */
            }

                .Displaytable tbody tr:hover {
                    background-color: rgba(0, 128, 0, 0.2); /* Highlight row on hover */
                }

        #submitButton {
            display: inline-block; /* Ensure the button is treated as a block */
            background-color: #4CAF50; /* Button background color */
            color: white; /* Button text color */
            padding: 10px 15px; /* Button padding */
            border-radius: 5px; /* Rounded button corners */
            margin-top: 15px; /* Margin above button */
            text-align: center; /* Center text */
            border: none; /* Remove default border */
            cursor: pointer; /* Change cursor to pointer */
            transition: background-color 0.3s; /* Smooth background color change */
        }

            #submitButton:hover {
                background-color: #45a049; /* Darker green on hover */
            }
    </style>
</head>

<body>
    <h1>Movie Seat Selection</h1>
    <h1>@Model.Showtime.Room.RoomType.RoomTypeName ROOM</h1>
    <div class="container" style="justify-content: space-between;">
        <!-- Left Block: User Input Form -->
        <div class="w3ls-reg">
            <div class="inputForm">
                <h2>Please select your seat, up to 5 seats</h2>
            </div>
            <ul class="seat_w3ls">
                <li class="smallBox greenBox">Selected Seat</li>
                <li class="smallBox redBox">Reserved Seat</li>
                <li class="smallBox emptyBox">Empty Seat</li>
            </ul>
            <div class="seatStructure txt-center" style="overflow-x:auto;">
                @{
                    var rowLabels = Enumerable.Range(0, Model.Showtime.Room.RoomType.NumberOfRow)
                    .Select(i => ((char)('A' + i)).ToString())
                    .ToArray();
                }

                <table id="seatsBlock">
                    <p id="notification"></p>
                    <tr>
                        <td></td>
                        @for (int i = 1; i <= Model.Showtime.Room.RoomType.NumberOfColumn; i++)
                        {
                            <td>@i</td>
                        }
                    </tr>

                    @foreach (var row in rowLabels)
                    {
                        <tr>
                            <td>@row</td>

                            @for (int column = 1; column <= Model.Showtime.Room.RoomType.NumberOfColumn; column++)
                            {
                                var seat = Model.Showtime.Room.Seats.FirstOrDefault(s => s.Row == row && s.Column == column);

                                if (seat != null)
                                {
                                    var seatPrice = seat.SeatType.SeatPrice;
                                    var seatType = seat.SeatType.SeatTypeName;
                                    var checkboxColor = seat.Status switch
                                    {
                                        SeatStatus.Available => "white",
                                        SeatStatus.Unavailable => "yellow",
                                        SeatStatus.Reserved => "red",
                                        _ => "white"
                                    };

                                    var checkboxDisabled = seat.Status != SeatStatus.Available ? "disabled" : "";

                                    <td style="text-align: center;">
                                        <input type="checkbox" class="cinema-seats" value="@seat.SeatId" @checkboxDisabled
                                               title="Seat Status: @(seat.Status)" style="display: none;"
                                               data-row="@row" data-column="@column"
                                               data-seat-price="@seatPrice" data-seat-type="@seatType">
                                        <span class="checkmark" style="background-color: @(checkboxColor); cursor: pointer;"
                                              data-seat-id="@seat.SeatId"
                                              data-seat-price="@seatPrice" data-seat-type="@seatType"></span>
                                    </td>
                                }
                                else // Nếu ghế là null, tạo một ô trống
                                {
                                    <td style="text-align: center;"></td>
                                }
                            }

                        </tr>
                    }
                </table>

                <div class="screen">
                    <h2 class="wthree">Screen this way</h2>
                </div>
            </div>
        </div>

        <!-- Right Block: Selected Seats Display -->
        <div class="displayerBoxes txt-center" style="flex: 1; overflow-x: auto;">
            <div class="inputForm">
                <h2>Selection Seats Information</h2>
            </div>
            <table class="Displaytable w3ls-table" width="100%">
                <thead>
                    <tr>
                        <th style="width: 33%;">Seat Type</th>
                        <th style="width: 33%;">Number of Seats</th>
                        <th style="width: 33%;">Price</th>
                    </tr>
                </thead>
                <tbody id="seatsInfoBody">
                    <!-- Rows will be dynamically added here -->
                </tbody>
                <tfoot>
                    <tr class="total-price">
                        <td colspan="2">Total Price:</td>
                        <td id="totalPrice">0.00 VND</td>
                    </tr>
                </tfoot>
            </table>

            <button id="confirmSelectionBtn" onclick="location.href='/Customer/Payment/Payment'">Confirm Selection</button>
        </div>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const selectedSeats = [];

            // Function to update the selection information
            function updateSelectionInfo() {
                const seatCounts = {};
                let totalPrice = 0; // Initialize total price

                selectedSeats.forEach(seat => {
                    const seatType = seat.type;
                    const seatPrice = seat.price;

                    if (!seatCounts[seatType]) {
                        seatCounts[seatType] = { count: 0, totalPrice: 0 };
                    }
                    seatCounts[seatType].count++;
                    seatCounts[seatType].totalPrice += seatPrice;
                    totalPrice += seatPrice; // Add to total price
                });

                const seatsInfoBody = document.getElementById("seatsInfoBody");
                seatsInfoBody.innerHTML = ""; // Clear previous rows

                // Add rows for each seat type
                for (const [type, info] of Object.entries(seatCounts)) {
                    const row = document.createElement("tr");

                    const typeCell = document.createElement("td");
                    typeCell.textContent = type;

                    const countCell = document.createElement("td");
                    countCell.textContent = info.count;

                    const priceCell = document.createElement("td");
                    priceCell.textContent = `${info.totalPrice.toFixed(2)} VND`; // Format price

                    row.appendChild(typeCell);
                    row.appendChild(countCell);
                    row.appendChild(priceCell);

                    seatsInfoBody.appendChild(row);
                }

                // Update the total price display
                document.getElementById("totalPrice").textContent = `${totalPrice.toFixed(2)} VND`;
            }

            // Event listener for each seat checkbox
            document.querySelectorAll("#seatsBlock .checkmark").forEach(span => {
                span.addEventListener("click", function () {
                    const checkbox = span.previousElementSibling; // Get the corresponding checkbox
                    const seatId = checkbox.value;
                    const seatType = checkbox.getAttribute("data-seat-type");
                    const seatPrice = parseFloat(checkbox.getAttribute("data-seat-price"));

                    if (checkbox && !checkbox.disabled) {
                        checkbox.checked = !checkbox.checked; // Toggle checkbox state

                        if (checkbox.checked) {
                            if (selectedSeats.length < 5) { // Limit selection to 5 seats
                                span.style.backgroundColor = "#28a745"; // Selected color
                                selectedSeats.push({ id: seatId, type: seatType, price: seatPrice });
                            } else {
                                alert("You can select a maximum of 5 seats.");
                                checkbox.checked = false; // Uncheck if limit exceeded
                            }
                        } else {
                            const index = selectedSeats.findIndex(seat => seat.id === seatId);
                            if (index > -1) {
                                selectedSeats.splice(index, 1);
                            }
                            span.style.backgroundColor = ""; // Reset color
                        }

                        updateSelectionInfo(); // Update the displayed selection info
                    }
                });
            });
        });
    </script>




</body>

</html>
